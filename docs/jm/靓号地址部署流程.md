# 靓号合约地址部署流程

## 概述

使用 Foundry 内置 CREATE2 将**任意合约**部署到靓号地址 (如 0x...1111, 0x...8888).

原理: `地址 = keccak256(0xff + deployer + salt + keccak256(initCode))[12:]`

## 部署步骤

### 1. 搜索 salt

`1111` 表示你想匹配的十六进制片段. 例如:
- 后缀靓号: 地址结尾是 `...1111`
- 前缀靓号: 地址开头是 `0x1111...`

```bash
# 后缀匹配
cast create2 --ends-with 1111 --init-code $(forge inspect Counter bytecode)

# 前缀匹配
cast create2 --starts-with 1111 --init-code $(forge inspect Counter bytecode)

# 任意位置匹配
cast create2 --matching 1111 --init-code $(forge inspect Counter bytecode)

# 前后缀组合匹配
cast create2 --starts-with dead --ends-with 1111 --init-code $(forge inspect Counter bytecode)
```

### 2. 把 salt 写入 .env

```
VANITY_SALT=0x找到的salt值
```

### 3. 部署

参考 `script/jm/DeployVanity.s.sol` 修改合约引用, 然后:

```bash
forge script script/jm/DeployVanity.s.sol --broadcast
```

> `foundry.toml` 已配置 `eth_rpc_url`/`[rpc_endpoints]`/`[etherscan]`, 不需要在命令里手动传 RPC 和验证 key.

### 4. 验证合约

先在 `foundry.toml` 配置:

```toml
[rpc_endpoints]
bsc_mainnet = "https://bsc-dataseed.binance.org"

[etherscan]
bsc = { key = "${BSCSCAN_API_KEY}" }
```

然后只需要:

```bash
forge verify-contract 0x05C6306764693CEd7420AD6ad2a507E98C308888 src/Counter.sol:Counter --chain bsc --watch
```

## 单元测试

```bash
forge test --match-path test/jm/Create2Vanity.t.sol -vvv --offline
```

## 注意事项

1. Salt 可公开, 无安全风险
2. 同一 salt + 同一 initCode 只能部署一次
3. **构造参数会影响 initCode** - 确定参数后再搜索 salt, 参数变了地址就变了
