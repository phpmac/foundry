# JM Token 需求文档

## 待确认事项

### 1. 撤池子税实现机制
- 状态: 待确认实现方案
- 问题: 撤池子税20%在用户调用 Router.removeLiquidity 时如何收取
- 需要确定: 在用户收到JM时扣税，还是在Router层面处理

### 2. 分红代币类型 (BNB vs WBNB)
- 状态: 待确认
- 问题: LP分红应该分发 BNB 还是 WBNB?
- 当前实现: 使用 BNB (用户可直接收到原生BNB)
- 备选方案: 使用 WBNB (PancakeSwap池子是WBNB/JM，可能更一致)

---

## 一、基础信息

| 项目 | 参数 |
|------|------|
| 代币名称 | JM |
| 发行总量 | 21,000,000 枚 (2100万) |
| 开盘价格 | 0.03 USD |
| 交易对 | JM/BNB |
| 底池规模 | 20 BNB |

## 二、锁仓与销毁

### 2.1 交易所费用锁仓
- 数量: 2,000,000 枚 (200万)
- 锁仓期: 1年
- 用途: 头部交易所上线费用
- 释放: 1年后解锁

### 2.2 燃烧机制
- 燃烧总量: 5,000,000 枚 (500万)
- 燃烧周期: 分10个月，每月燃烧 500,000 枚
- 燃烧方式: 从底池提取 JM 发送至死亡地址 `0x000...dEaD`
- 触发权限: **任何人都可以调用** `monthlyBurn()`
- 冷却时间: 每次燃烧间隔 >= 30 天

## 三、私募规则

| 项目 | 参数 |
|------|------|
| 总份数 | 2000 份 |
| 每份价格 | 0.2 BNB |
| 每份代币 | 6000 JM |
| 私募总量 | 12,000,000 JM (2000 * 6000) |
| 参与方式 | 任何人转账 0.2 BNB 到合约自动获得 6000 JM |
| 结束条件 | 满2000份自动停止 / 或手动关闭 |

## 四、交易滑点

### 4.1 买滑点 (3%)
| 用途 | 比例 |
|------|------|
| 回流 | 1% |
| LP分红 (BNB) | 1.5% |
| 黑洞 | 0.5% |

### 4.2 卖滑点 (3%)
| 用途 | 比例 |
|------|------|
| 回流 | 1% |
| LP分红 (BNB) | 1.5% |
| 黑洞 | 0.5% |

### 4.3 撤池子税 (20%)
| 用途 | 比例 |
|------|------|
| 回流 | 10% |
| LP分红 (BNB) | 5% |
| 黑洞 | 5% |

## 五、LP 暴力分红机制

### 5.1 参与门槛
- LP 价值必须 > 100 USD (按 BNB 价格计算)
- 持有 JMB 凭证 (LP Token 质押后获得)

### 5.2 分红来源
- 买滑点 1.5% (BNB)
- 卖滑点 1.5% (BNB)
- 撤池子税 5% (BNB)

### 5.3 解锁机制 (核心)
**规则**: 分红赚了 X BNB，必须先买 >= X BNB 的 JM 才能解锁领取

**示例**:
- 用户A LP价值 100 BNB
- 累积分红赚了 50 BNB
- 必须先买入 >= 50 BNB 的 JM
- 买入后自动解锁，可领取 50 BNB 分红
- 下一笔交易时若分红又增加到 80 BNB，需再买 >= 80 BNB 才能领

### 5.4 领取方式
- 用户主动调用 `claimReward()`
- 或用户买/卖 JM 时自动领取

### 5.5 JMB 凭证
- 独立 ERC20 Token，作为 LP 分红资格凭证
- 用户添加 LP 后将 LP Token 质押到合约，获得 JMB
- JMB 数量与用户 LP 价值成正比
- 撤池时退还 LP Token，销毁 JMB

## 六、权限设计

### 6.1 需要权限的功能 (部署后保留)
- 开启/关闭交易
- 设置白名单
- 紧急暂停

### 6.2 无权限功能 (可 renounceOwnership 后继续使用)
- 每月燃烧 `monthlyBurn()` - 任何人可触发
- 私募自动发放 - 任何人可参与
- LP 分红累积与领取 - 全自动运行

## 七、合约架构

```
JMToken.sol          - 主代币合约 (ERC20)
├── JMBToken.sol     - LP凭证代币
├── LPDividend.sol   - LP分红管理合约
└── interfaces/
    ├── IPancakeRouter.sol
    ├── IPancakePair.sol
    └── IPancakeFactory.sol
```

## 八、部署流程

1. 部署 JMToken 合约
2. 部署 JMBToken 合约
3. 部署 LPDividend 合约
4. 设置合约间关联地址
5. 手动添加 20 BNB + 对应 JM 到 Pancake 创建底池
6. 将 LP Token 转入合约用于后续燃烧
7. 开启交易
8. (可选) renounceOwnership 丢掉权限

## 九、关键计算

### 9.1 私募后代币分配
| 用途 | 数量 |
|------|------|
| 私募发放 | 12,000,000 JM |
| 交易所锁仓 | 2,000,000 JM |
| 底池流动性 | (20 BNB / 0.03 USD) ≈ 666,667 JM |
| 燃烧预留 | 5,000,000 JM |
| 合约持有 | 剩余部分 |

### 9.2 流通量计算
- 初始流通: 私募部分 + 底池部分
- 每月燃烧后: 死亡地址余额增加，流通量减少
- 最终流通: 21,000,000 - 5,000,000(燃烧) = 16,000,000 JM

## 十、安全考虑

1. **闪电贷攻击防护**: LP分红基于时间加权，防止闪电贷刷分红
2. **重入攻击防护**: 使用 Checks-Effects-Interactions 模式
3. **滑点保护**: 用户交易时设置最小获得量
4. **权限最小化**: 核心功能无需权限，可完全去中心化运行
